module.exports=[18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},29173,(e,t,r)=>{t.exports=e.x("@prisma/client",()=>require("@prisma/client"))},37219,90177,e=>{"use strict";var t=e.i(29173);let r=new Proxy({},{get(e,r){let n=function(){if(globalThis.__prisma)return globalThis.__prisma;if(!process.env.DATABASE_URL)throw Error("DATABASE_URL is not configured");return new t.PrismaClient({log:["error"]})}(),s=n[r];return"function"==typeof s?s.bind(n):s}});e.s(["prisma",0,r],90177),e.s([],37219)},54478,e=>{"use strict";e.i(37219);var t=e.i(90177);class r{name="mock";async fulfill(e){let{orderId:t,productId:r,quantity:n}=e,s=2e3*Math.random()+1e3;if(await new Promise(e=>setTimeout(e,s)),Math.random()>.05){let e=`MOCK-${t}-${Date.now()}-${Math.random().toString(36).substring(7)}`;return console.log(`[Mock Fulfillment] Order ${t} fulfilled successfully`,{productId:r,quantity:n,transactionId:e}),{success:!0,transactionId:e,message:`Mock fulfillment completed for order ${t}`,metadata:{provider:"mock",fulfilledAt:new Date().toISOString(),productId:r,quantity:n}}}{let e=["Insufficient stock","Product temporarily unavailable","Processing timeout","Invalid product configuration"],s=e[Math.floor(Math.random()*e.length)];return console.error(`[Mock Fulfillment] Order ${t} failed`,{productId:r,quantity:n,error:s}),{success:!1,error:s,message:`Mock fulfillment failed: ${s}`,metadata:{provider:"mock",failedAt:new Date().toISOString(),productId:r,quantity:n}}}}async checkStatus(e){return await new Promise(e=>setTimeout(e,500)),{success:!0,transactionId:e,message:"Mock transaction completed",metadata:{provider:"mock",status:"completed"}}}async isProductAvailable(e){return await new Promise(e=>setTimeout(e,200)),!0}}class n{name="digiflazz";apiKey;username;baseUrl;constructor(){this.apiKey=process.env.DIGIFLAZZ_API_KEY||"",this.username=process.env.DIGIFLAZZ_USERNAME||"",this.baseUrl=process.env.DIGIFLAZZ_BASE_URL||"https://api.digiflazz.com/v1",this.apiKey&&this.username||console.warn("[Digiflazz] API credentials not configured")}async fulfill(e){if(!this.apiKey||!this.username)return{success:!1,error:"Digiflazz API credentials not configured",message:"DIGIFLAZZ_API_KEY and DIGIFLAZZ_USERNAME must be set"};throw Error("Digiflazz fulfillment not yet implemented")}async checkStatus(e){if(!this.apiKey||!this.username)return{success:!1,error:"Digiflazz API credentials not configured"};throw Error("Digiflazz status check not yet implemented")}async isProductAvailable(e){return!!this.apiKey&&!!this.username}}async function s(e,t,s){let a=s||function(e="mock"){switch(e){case"mock":return new r;case"digiflazz":return new n;default:return console.warn(`Unknown fulfillment provider type: ${e}, falling back to mock`),new r}}(process.env.FULFILLMENT_PROVIDER||"mock"),i=(await Promise.allSettled(t.map(async t=>{let r=await a.fulfill({orderId:e,productId:t.productId,quantity:t.quantity});return{productId:t.productId,result:r}}))).map((e,r)=>"fulfilled"===e.status?e.value:{productId:t[r].productId,result:{success:!1,error:e.reason?.message||"Unknown error"}}),o=i.every(e=>e.result.success),l={orderId:e,provider:a.name,items:i,timestamp:new Date().toISOString()};return{success:o,results:i,payload:l}}async function a(e){let r=await t.prisma.order.findUnique({where:{id:e},include:{items:!0}});if(!r)throw Error(`Order ${e} not found`);if("PAID"!==r.status)throw Error(`Order ${e} is not in PAID status`);let n=await s(e,r.items.map(e=>({productId:e.productId,quantity:e.quantity}))),a=n.success?"SUCCESS":"FAILED",i=n.success?null:n.results.filter(e=>!e.result.success).map(e=>e.result.error||"Unknown error").join("; ");await t.prisma.order.update({where:{id:e},data:{fulfillmentStatus:a,fulfillmentAttemptCount:{increment:1},fulfillmentLastError:i,fulfillmentPayloadJson:n.payload,...n.success&&{status:"FULFILLED"}}}),console.log(`[Fulfillment] Order ${e} processed: ${a}`,{attemptCount:r.fulfillmentAttemptCount+1,lastError:i})}async function i(e){try{return(await t.prisma.order.updateMany({where:{id:e,status:"PAID",fulfillmentStatus:{in:["NOT_STARTED","FAILED"]},fulfillmentAttemptCount:{lt:3}},data:{fulfillmentStatus:"PENDING"}})).count>0}catch(t){return console.error(`[Fulfillment] Failed to start fulfillment for order ${e}:`,t),!1}}e.s(["processOrderFulfillment",()=>a,"tryStartFulfillment",()=>i],54478)},21456,e=>{"use strict";var t=e.i(46820),r=e.i(99839),n=e.i(38209),s=e.i(1647),a=e.i(65720),i=e.i(95367),o=e.i(90115),l=e.i(20881),u=e.i(48661),d=e.i(14834),c=e.i(62865),p=e.i(95897),f=e.i(48383),m=e.i(55301),h=e.i(53757),g=e.i(66508),w=e.i(93695);e.i(46459);var y=e.i(74586),v=e.i(12473);e.i(37219);var x=e.i(90177),R=e.i(54478);async function E(e,{params:t}){let{id:r}=await t,n=Number(r),s=e.headers.get("x-admin-key"),a=process.env.ADMIN_KEY;if(!a)return console.error("ADMIN_KEY is not configured"),v.NextResponse.json({error:"Server configuration error"},{status:500});if(s!==a)return v.NextResponse.json({error:"Unauthorized"},{status:401});if(!Number.isFinite(n)||n<=0)return v.NextResponse.json({error:"Invalid order id"},{status:400});let i=await x.prisma.order.findUnique({where:{id:n}});return i?"PAID"!==i.status?v.NextResponse.json({error:`Order is not in PAID status (current: ${i.status})`},{status:400}):"PENDING"===i.fulfillmentStatus?v.NextResponse.json({error:"Fulfillment is already in progress",currentStatus:i.fulfillmentStatus},{status:409}):"SUCCESS"===i.fulfillmentStatus?v.NextResponse.json({error:"Fulfillment already completed successfully",currentStatus:i.fulfillmentStatus},{status:409}):0===(await x.prisma.order.updateMany({where:{id:n,status:"PAID",fulfillmentStatus:{in:["NOT_STARTED","FAILED"]}},data:{fulfillmentStatus:"PENDING"}})).count?v.NextResponse.json({error:"Fulfillment cannot be started",currentStatus:i.fulfillmentStatus,message:"Order status does not allow fulfillment retry"},{status:409}):((0,R.processOrderFulfillment)(n).catch(e=>{console.error(`[Admin Retry] Failed to process order ${n}:`,e),x.prisma.order.update({where:{id:n},data:{fulfillmentStatus:"FAILED",fulfillmentLastError:(e instanceof Error?e.message:String(e))||"Unknown error",fulfillmentAttemptCount:{increment:1}}}).catch(e=>{console.error(`[Admin Retry] Failed to update order ${n} status:`,e)})}),v.NextResponse.json({success:!0,message:`Fulfillment started for order ${n}`,orderId:n})):v.NextResponse.json({error:"Order not found"},{status:404})}e.s(["POST",()=>E],92637);var A=e.i(92637);let I=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/admin/orders/[id]/retry-fulfillment/route",pathname:"/api/admin/orders/[id]/retry-fulfillment",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/admin/orders/[id]/retry-fulfillment/route.ts",nextConfigOutput:"",userland:A}),{workAsyncStorage:S,workUnitAsyncStorage:P,serverHooks:D}=I;function N(){return(0,n.patchFetch)({workAsyncStorage:S,workUnitAsyncStorage:P})}async function C(e,t,n){I.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let v="/api/admin/orders/[id]/retry-fulfillment/route";v=v.replace(/\/index$/,"")||"/";let x=await I.prepare(e,t,{srcPage:v,multiZoneDraftMode:!1});if(!x)return t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:R,params:E,nextConfig:A,parsedUrl:S,isDraftMode:P,prerenderManifest:D,routerServerContext:N,isOnDemandRevalidate:C,revalidateOnlyGenerated:k,resolvedPathname:b,clientReferenceManifest:O,serverActionsManifest:T}=x,_=(0,l.normalizeAppPath)(v),F=!!(D.dynamicRoutes[_]||D.routes[b]),M=async()=>((null==N?void 0:N.render404)?await N.render404(e,t,S,!1):t.end("This page could not be found"),null);if(F&&!P){let e=!!D.routes[b],t=D.dynamicRoutes[_];if(t&&!1===t.fallback&&!e){if(A.experimental.adapterPath)return await M();throw new w.NoFallbackError}}let U=null;!F||I.isDev||P||(U="/index"===(U=b)?"/":U);let j=!0===I.isDev||!F,q=F&&!j;T&&O&&(0,i.setReferenceManifestsSingleton)({page:v,clientReferenceManifest:O,serverActionsManifest:T,serverModuleMap:(0,o.createServerModuleMap)({serverActionsManifest:T})});let $=e.method||"GET",L=(0,a.getTracer)(),K=L.getActiveScopeSpan(),z={params:E,prerenderManifest:D,renderOpts:{experimental:{authInterrupts:!!A.experimental.authInterrupts},cacheComponents:!!A.cacheComponents,supportsDynamicResponse:j,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:A.cacheLife,waitUntil:n.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,n)=>I.onRequestError(e,t,n,N)},sharedContext:{buildId:R}},H=new u.NodeNextRequest(e),G=new u.NodeNextResponse(t),Z=d.NextRequestAdapter.fromNodeNextRequest(H,(0,d.signalFromNodeResponse)(t));try{let i=async e=>I.handle(Z,z).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=L.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=r.get("next.route");if(n){let t=`${$} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${$} ${v}`)}),o=!!(0,s.getRequestMeta)(e,"minimalMode"),l=async s=>{var a,l;let u=async({previousCacheEntry:r})=>{try{if(!o&&C&&k&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await i(s);e.fetchMetrics=z.renderOpts.fetchMetrics;let l=z.renderOpts.pendingWaitUntil;l&&n.waitUntil&&(n.waitUntil(l),l=void 0);let u=z.renderOpts.collectedTags;if(!F)return await (0,f.sendResponse)(H,G,a,z.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(a.headers);u&&(t[g.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==z.renderOpts.collectedRevalidate&&!(z.renderOpts.collectedRevalidate>=g.INFINITE_CACHE)&&z.renderOpts.collectedRevalidate,n=void 0===z.renderOpts.collectedExpire||z.renderOpts.collectedExpire>=g.INFINITE_CACHE?void 0:z.renderOpts.collectedExpire;return{value:{kind:y.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:n}}}}catch(t){throw(null==r?void 0:r.isStale)&&await I.onRequestError(e,t,{routerKind:"App Router",routePath:v,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:C})},N),t}},d=await I.handleResponse({req:e,nextConfig:A,cacheKey:U,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:D,isRoutePPREnabled:!1,isOnDemandRevalidate:C,revalidateOnlyGenerated:k,responseGenerator:u,waitUntil:n.waitUntil,isMinimalMode:o});if(!F)return null;if((null==d||null==(a=d.value)?void 0:a.kind)!==y.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(l=d.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",C?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),P&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,m.fromNodeOutgoingHttpHeaders)(d.value.headers);return o&&F||c.delete(g.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,h.getCacheControlHeader)(d.cacheControl)),await (0,f.sendResponse)(H,G,new Response(d.value.body,{headers:c,status:d.value.status||200})),null};K?await l(K):await L.withPropagatedContext(e.headers,()=>L.trace(c.BaseServerSpan.handleRequest,{spanName:`${$} ${v}`,kind:a.SpanKind.SERVER,attributes:{"http.method":$,"http.target":e.url}},l))}catch(t){if(t instanceof w.NoFallbackError||await I.onRequestError(e,t,{routerKind:"App Router",routePath:_,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:C})}),F)throw t;return await (0,f.sendResponse)(H,G,new Response(null,{status:500})),null}}e.s(["handler",()=>C,"patchFetch",()=>N,"routeModule",()=>I,"serverHooks",()=>D,"workAsyncStorage",()=>S,"workUnitAsyncStorage",()=>P],21456)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__29502530._.js.map
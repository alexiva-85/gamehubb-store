module.exports=[56704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},20635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},78830,(a,b,c)=>{"use strict";b.exports=a.r(30770).vendored.contexts.AppRouterContext},58975,(a,b,c)=>{"use strict";b.exports=a.r(30770).vendored.contexts.HooksClientContext},47308,(a,b,c)=>{"use strict";b.exports=a.r(30770).vendored.contexts.ServerInsertedHtml},42133,a=>{"use strict";var b=a.i(14046),c=a.i(98154),d=a.i(88572),e=a.i(95407),f=a.i(46749),g=a.i(69976),h=a.i(45589),i=a.i(13589),j=a.i(29735),k=a.i(82496),l=a.i(15890),m=a.i(30952);let n=(0,f.forwardRef)((a,n)=>{let o;var{children:p,titleBadge:q,hint:r,subhead:s,subtitle:t,description:u,className:v,before:w,after:x,Component:y,hovered:z,multiline:A}=a,B=(0,d._)(a,["children","titleBadge","hint","subhead","subtitle","description","className","before","after","Component","hovered","multiline"]);let C=(0,i.usePlatform)(),{Title:D,Description:E}=(o="ios"===(0,i.usePlatform)(),{Title:(0,f.useCallback)(a=>o?(0,e.jsx)(m.Text,(0,b._)({},a)):(0,e.jsx)(k.Subheadline,(0,b._)({level:"1"},a)),[o]),Description:(0,f.useCallback)(a=>o?(0,e.jsx)(l.Caption,(0,b._)({},a)):(0,e.jsx)(k.Subheadline,(0,b._)({level:"2"},a)),[o])}),F=(0,h.hasReactNode)(p)||(0,h.hasReactNode)(r)||(0,h.hasReactNode)(q);return(0,e.jsxs)(j.Tappable,(0,c._)((0,b._)({ref:n,Component:y||"div",className:(0,g.classNames)("tgui-b8dfba0b5c3d054c","ios"===C&&"tgui-7b5bccbb645b495f",z&&"tgui-7edaaf0c57797623",A&&"tgui-6c49dadccf648a5b",v)},B),{children:[(0,h.hasReactNode)(w)&&(0,e.jsx)("div",{className:"tgui-aaa795d78c356ac1",children:w}),(0,e.jsxs)("div",{className:"tgui-8735a62be5a8b8a7",children:[(0,h.hasReactNode)(s)&&(0,e.jsx)(k.Subheadline,{className:"tgui-46dd90b57ffed25f",level:"2",weight:"3",children:s}),F&&(0,e.jsxs)(D,{className:"tgui-a894f59f4c5ad72f",children:[(0,h.hasReactNode)(p)&&(0,e.jsx)("span",{className:"tgui-1c6d7865a76a19bc",children:p}),(0,h.hasReactNode)(r)&&(0,e.jsx)("span",{className:"tgui-bb909928b48f948b",children:r}),(0,h.hasReactNode)(q)&&q]}),(0,h.hasReactNode)(t)&&(0,e.jsx)(k.Subheadline,{className:"tgui-d528ef65a8b76273",level:"2",weight:"3",children:t}),(0,h.hasReactNode)(u)&&(0,e.jsx)(E,{className:"tgui-fc059ed3ac5799a6",children:u})]}),(0,h.hasReactNode)(x)&&(0,e.jsx)("div",{className:"tgui-56b2e897ed7ccb22",children:x})]}))});a.s(["Cell",0,n],42133)},65850,a=>{"use strict";var b=a.i(14046),c=a.i(98154),d=a.i(88572),e=a.i(95407),f=a.i(46749),g=a.i(69976);let h=(0,f.forwardRef)((a,f)=>{var{Component:h="span",className:i}=a,j=(0,d._)(a,["Component","className"]);return(0,e.jsx)(h,(0,c._)((0,b._)({},j),{ref:f,className:(0,g.classNames)("tgui-b9fd8cdf929947df",i)}))});var i=a.i(54215),j=a.i(74838);let k=a=>{var d=(0,i._)({},(0,j._)(a));return(0,e.jsx)("svg",(0,c._)((0,b._)({width:"20",height:"20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},d),{children:(0,e.jsx)("path",{d:"M6.4 1h7.2c1.14 0 1.93 0 2.55.05.6.05.95.14 1.21.28a3 3 0 0 1 1.31 1.3c.14.27.23.62.28 1.22.05.62.05 1.41.05 2.55v7.2c0 1.14 0 1.93-.05 2.55-.05.6-.14.95-.28 1.21a3 3 0 0 1-1.3 1.31c-.27.14-.62.23-1.22.28-.62.05-1.41.05-2.55.05H6.4c-1.14 0-1.93 0-2.55-.05-.6-.05-.95-.14-1.21-.28a3 3 0 0 1-1.31-1.3 3.2 3.2 0 0 1-.28-1.22A34.7 34.7 0 0 1 1 13.6V6.4c0-1.14 0-1.93.05-2.55.05-.6.14-.95.28-1.21a3 3 0 0 1 1.3-1.31 3.2 3.2 0 0 1 1.22-.28C4.47 1 5.26 1 6.4 1Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}))},l=a=>{var d=(0,i._)({},(0,j._)(a));return(0,e.jsxs)("svg",(0,c._)((0,b._)({width:"20",height:"20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},d),{children:[(0,e.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M.48 2.87C0 3.88 0 5.2 0 7.8v4.4c0 2.61 0 3.92.48 4.93a5 5 0 0 0 2.4 2.4c1 .47 2.3.47 4.92.47h4.4c2.61 0 3.92 0 4.93-.48a5 5 0 0 0 2.4-2.4c.47-1 .47-2.3.47-4.92V7.8c0-2.61 0-3.92-.48-4.93a5 5 0 0 0-2.4-2.4C16.13 0 14.83 0 12.2 0H7.8C5.19 0 3.88 0 2.87.48a5 5 0 0 0-2.4 2.4ZM15.7 7.46a1 1 0 0 0-1.42-1.42L8 12.34l-2.3-2.3a1 1 0 1 0-1.4 1.42l3 3a1 1 0 0 0 1.4 0l7-7Z",fill:"currentColor"}),(0,e.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M15.7 7.46a1 1 0 0 0-1.4-1.42L8 12.34l-2.3-2.3a1 1 0 1 0-1.4 1.42l3 3a1 1 0 0 0 1.4 0l7-7Z",fill:"#fff"})]}))},m=a=>{var d=(0,i._)({},(0,j._)(a));return(0,e.jsxs)("svg",(0,c._)((0,b._)({width:"20",height:"20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},d),{children:[(0,e.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.4 0h7.2c2.24 0 3.36 0 4.22.44a4 4 0 0 1 1.74 1.74c.44.86.44 1.98.44 4.22v7.2c0 2.24 0 3.36-.44 4.22a4 4 0 0 1-1.74 1.74c-.86.44-1.98.44-4.22.44H6.4c-2.24 0-3.36 0-4.22-.44a4 4 0 0 1-1.74-1.74C0 16.96 0 15.84 0 13.6V6.4c0-2.24 0-3.36.44-4.22A4 4 0 0 1 2.18.44C3.04 0 4.16 0 6.4 0ZM4 10a1 1 0 0 1 1-1h10a1 1 0 1 1 0 2H5a1 1 0 0 1-1-1Z",fill:"currentColor"}),(0,e.jsx)("path",{d:"M4 10a1 1 0 0 1 1-1h10a1 1 0 1 1 0 2H5a1 1 0 0 1-1-1Z",fill:"#fff"})]}))},n=(0,f.forwardRef)((a,f)=>{var{style:i,className:j,disabled:n,indeterminate:o}=a,p=(0,d._)(a,["style","className","disabled","indeterminate"]);return(0,e.jsxs)("label",{className:(0,g.classNames)("tgui-abbb25a9ce45033e",n&&"tgui-6e9776e8c33b2626",j),children:[(0,e.jsx)(h,(0,c._)((0,b._)({},p),{ref:f,Component:"input",type:"checkbox",className:"tgui-60cf4cc79ba44c4f",disabled:n})),(0,e.jsx)(k,{className:"tgui-21b20ecaad17ccf9","aria-hidden":!0}),(0,e.jsx)("div",{"aria-hidden":!0,className:"tgui-bca5056bf34297b0",children:o?(0,e.jsx)(m,{}):(0,e.jsx)(l,{})})]})});a.s(["Checkbox",0,n],65850)},28940,a=>{"use strict";var b=a.i(95407);function c({type:a="info",children:c,className:d}){return(0,b.jsx)("div",{className:d,style:{padding:"12px 16px",color:(()=>{switch(a){case"error":return"var(--tg-theme-destructive-text-color, #ff3b30)";case"warning":return"var(--tg-theme-hint-color, #ff9500)";case"success":return"var(--tg-theme-link-color, #34c759)";default:return"var(--tg-theme-hint-color, #999999)"}})(),backgroundColor:"var(--tg-theme-secondary-bg-color, #f1f1f1)",borderRadius:"8px",margin:"8px 16px",fontSize:"14px",lineHeight:"1.4"},children:c})}a.s(["Banner",()=>c])},32383,a=>{"use strict";var b=a.i(95407);function c({amountKopeks:a,currency:c="RUB",className:d}){let e=`${(a/100).toFixed(2)} ${c}`;return(0,b.jsx)("span",{className:d,children:e})}a.s(["Price",()=>c])},19032,76918,a=>{"use strict";function b(){return null}function c(a){}async function d(a){return!1}function e(a){}async function f(a){let b=(a.headers.get("Content-Type")??"").includes("application/json"),c=b?await a.json().catch(()=>({})):await a.text();if(!a.ok){let d=Error(b&&c?.error||("string"==typeof c?c:"Request failed"));throw d.status=a.status,d.payload=c,d}return c}function g(a){let c={"Content-Type":"application/json"};if(a?.auth){let a=b();if(!a){let b=process.env.NEXT_PUBLIC_E2E_TG_INIT_DATA??process.env.E2E_TG_INIT_DATA;"string"==typeof b&&b.length>0&&(a=b)}a&&(c["x-telegram-init-data"]=a)}return a?.idempotencyKey&&(c["x-idempotency-key"]=a.idempotencyKey),c}async function h(a,b){return f(await fetch(a,{method:"GET",headers:g(b),signal:b?.signal}))}async function i(a,b,c){return f(await fetch(a,{method:"POST",headers:g(c),body:JSON.stringify(b??{}),signal:c?.signal}))}a.s(["copyToClipboard",()=>d,"getInitData",()=>b,"openExternal",()=>c,"openSupport",()=>e],76918),a.s(["apiGet",()=>h,"apiPost",()=>i],19032)},94894,a=>{"use strict";var b=a.i(95407),c=a.i(46749);a.i(62720);var d=a.i(97429),e=a.i(75535),f=a.i(39150),g=a.i(65850),h=a.i(42133),i=a.i(47132),j=a.i(74547),k=a.i(15149),l=a.i(28940),m=a.i(32383),n=a.i(14993),o=a.i(19032),p=a.i(84093),q=a.i(28610),r=a.i(76918);function s(){let a=(0,i.useRouter)(),{cart:s}=(0,q.useCart)(),[t,u]=(0,c.useState)(0),[v,w]=(0,c.useState)("RUB"),[x,y]=(0,c.useState)(!1),[z,A]=(0,c.useState)(null),[B,C]=(0,c.useState)(null),[D,E]=(0,c.useState)(null),[F,G]=(0,c.useState)(!1),H=(0,c.useRef)(!1);(0,c.useEffect)(()=>{let b=(0,p.getCart)();0===b.length?a.replace("/cart"):(async()=>{try{let a=await (0,o.apiGet)("/api/products"),c=0,d="RUB";for(let e of b){let b=a.find(a=>a.id===e.productId);b&&(c+=b.priceKopeks*e.qty,d=b.currency)}u(c),w(d)}catch(a){console.error(a),A("Не удалось проверить корзину")}})()},[a]);let I=async()=>{if(!x){if(!s.length)return void A("Корзина пуста. Добавьте товары перед оформлением заказа.");if(!F)return void A("Необходимо согласиться с условиями публичной оферты.");y(!0),A(null);try{let b=`${Date.now()}-${Math.random().toString(16).slice(2)}`,c=await (0,o.apiPost)("/api/orders",{items:s.map(a=>({productId:a.productId,qty:a.qty}))},{auth:!0,idempotencyKey:b});(0,p.clear)(),C(c.orderId),E(c.paymentUrl??null),c.paymentUrl&&!H.current&&(H.current=!0,(0,r.openExternal)(c.paymentUrl)),a.push(`/orders/${c.orderId}`)}catch(b){console.error(b);let a=b?.status;401===a||403===a?A("Не удалось подтвердить авторизацию в Telegram. Откройте мини‑приложение из Telegram и попробуйте ещё раз."):a&&a>=500?A("Сервис временно недоступен. Попробуйте позже."):A(b?.message??"Ошибка при создании заказа")}finally{y(!1)}}},J=(0,b.jsxs)("div",{children:[t>0&&(0,b.jsxs)("div",{style:{marginBottom:12,fontSize:18,fontWeight:600},children:["Сумма к оплате: ",(0,b.jsx)(m.Price,{amountKopeks:t,currency:v})]}),B?D?(0,b.jsx)(d.Button,{size:"m",mode:"filled",stretched:!0,onClick:()=>(0,r.openExternal)(D),children:"Открыть оплату ещё раз"}):(0,b.jsx)(l.Banner,{type:"info",className:"app-shell__sticky-bottom-banner",children:"Заказ создан. Если окно оплаты не открылось, проверьте статус заказа."}):(0,b.jsx)(d.Button,{size:"m",mode:"filled",stretched:!0,loading:x,disabled:x||!F,onClick:I,children:x?"Создаём заказ…":"Создать заказ"})]});return(0,b.jsx)(j.Page,{children:(0,b.jsx)(k.AppShell,{title:"Оформление заказа",stickyBottom:J,children:(0,b.jsxs)(e.List,{children:[(0,b.jsxs)(f.Section,{header:"Детали заказа",children:[z&&(0,b.jsx)(l.Banner,{type:"error",children:z}),B&&!D&&(0,b.jsxs)(l.Banner,{type:"success",children:["Заказ №",B," создан. Ожидайте открытия окна оплаты."]})]}),(0,b.jsx)(f.Section,{children:(0,b.jsxs)(h.Cell,{before:(0,b.jsx)(g.Checkbox,{checked:F,onChange:a=>{G(a.target.checked)}}),after:(0,b.jsx)(n.Link,{href:"/oferta",style:{fontSize:"12px",color:"var(--tg-theme-link-color, #2481cc)"},children:"Прочитать"}),onClick:()=>G(!F),children:["Я согласен с условиями"," ",(0,b.jsx)(n.Link,{href:"/oferta",style:{color:"var(--tg-theme-link-color, #2481cc)"},children:"публичной оферты"})]})})]})})})}a.s(["default",()=>s])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__6ce7ae31._.js.map
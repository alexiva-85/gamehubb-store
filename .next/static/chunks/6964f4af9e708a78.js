(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,87246,e=>{"use strict";var t=e.i(3008);function n({width:e,height:n,className:s,variant:r="text"}){let i={};return e&&(i.width="number"==typeof e?`${e}px`:e),n&&(i.height="number"==typeof n?`${n}px`:n),"circular"===r&&(i.borderRadius="50%"),(0,t.jsx)("div",{className:`${"text"===r?"skeleton skeleton-text":"card"===r?"skeleton skeleton-card":"skeleton"} ${s||""}`,style:i})}e.s(["Skeleton",()=>n])},44625,e=>{"use strict";var t=e.i(3008),n=e.i(21453);e.i(37181);var s=e.i(4977),r=e.i(79317),i=e.i(28463),l=e.i(81304),u=e.i(27811),c=e.i(42537),a=e.i(39911),o=e.i(49830),d=e.i(57512),f=e.i(27808),m=e.i(87246),h=e.i(9165),p=e.i(55379);function x(){let e=(0,c.useRouter)(),x=Number((0,c.useParams)().id),[j,y]=(0,n.useState)(null),[A,E]=(0,n.useState)(!0),[C,S]=(0,n.useState)(null),L=(0,n.useMemo)(()=>j&&("PAID"===j.status||"FULFILLED"===j.status||"CANCELED"===j.status),[j]);(0,n.useEffect)(()=>{let e;if(!Number.isFinite(x)||x<=0){S("Некорректный идентификатор заказа"),E(!1);return}let t=!1,n=async()=>{try{let s=await (0,h.apiGet)(`/api/orders/${x}`,{auth:!0});if(t)return;y(s),S(null),"PAID"!==s.status&&"FULFILLED"!==s.status&&"CANCELED"!==s.status&&(e=window.setTimeout(n,1500))}catch(n){if(t)return;console.error(n);let e=n?.status;401===e||403===e?S("Недостаточно прав для просмотра заказа. Убедитесь, что вы открыли мини‑приложение тем же пользователем Telegram."):404===e?S("Заказ не найден."):S("Не удалось загрузить статус заказа. Попробуйте позже.")}finally{t||E(!1)}};return n(),()=>{t=!0,void 0!==e&&window.clearTimeout(e)}},[x]);let g=j&&("PAID"===j.status||"FULFILLED"===j.status),D=g?(0,t.jsx)(s.Button,{size:"m",mode:"filled",stretched:!0,onClick:()=>e.replace("/catalog"),children:"Вернуться в каталог"}):L?(0,t.jsx)(s.Button,{size:"m",mode:"bezeled",stretched:!0,onClick:()=>e.replace("/catalog"),children:"Вернуться в каталог"}):null;return(0,t.jsx)(a.Page,{children:(0,t.jsx)(o.AppShell,{title:`Заказ №${x}`,stickyBottom:D,children:(0,t.jsxs)(i.List,{children:[A&&(0,t.jsxs)(l.Section,{children:[(0,t.jsx)("div",{style:{padding:16,display:"flex",justifyContent:"center"},children:(0,t.jsx)(u.Spinner,{size:"m"})}),(0,t.jsx)(m.Skeleton,{variant:"card"}),(0,t.jsx)(m.Skeleton,{variant:"card"})]}),!A&&C&&(0,t.jsx)(l.Section,{children:(0,t.jsx)(d.Banner,{type:"error",children:C})}),!A&&!C&&j&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(l.Section,{header:"Информация о заказе",children:[(0,t.jsx)(d.Banner,{type:function(e){switch(e){case"PAID":case"FULFILLED":return"success";case"CANCELED":return"error";case"AUTHORIZED":return"warning";default:return"info"}}(j.status),children:(0,t.jsx)("strong",{children:function(e){switch(e){case"NEW":return"Заказ создан, ожидание оплаты";case"PAYMENT_CREATED":return"Ожидание оплаты в банке";case"AUTHORIZED":return"Оплата авторизована, ожидается подтверждение";case"PAID":case"FULFILLED":return"Оплата получена";case"CANCELED":return"Заказ отменён";default:return e}}(j.status)})}),(0,t.jsxs)("div",{style:{padding:"8px 16px",fontSize:14},children:[(0,t.jsxs)("div",{style:{marginBottom:8},children:[(0,t.jsx)("strong",{children:"Сумма:"})," ",(0,t.jsx)(f.Price,{amountKopeks:j.totalAmountKopeks,currency:j.currency})]}),j.fulfillmentStatus&&"PAID"===j.status&&(0,t.jsxs)("div",{style:{marginTop:12},children:[(0,t.jsxs)("div",{style:{marginBottom:4},children:[(0,t.jsx)("strong",{children:"Статус выполнения:"})," ",function(e){switch(e){case"NOT_STARTED":return"Ожидание выполнения";case"PENDING":return"Выполняется...";case"SUCCESS":return"Выполнено успешно";case"FAILED":return"Ошибка выполнения";default:return e}}(j.fulfillmentStatus)]}),void 0!==j.fulfillmentAttemptCount&&j.fulfillmentAttemptCount>0&&(0,t.jsxs)("div",{style:{fontSize:12,opacity:.7,marginTop:4},children:["Попыток: ",j.fulfillmentAttemptCount]}),j.fulfillmentLastError&&(0,t.jsx)("div",{style:{marginTop:8},children:(0,t.jsxs)(d.Banner,{type:function(e){switch(e){case"SUCCESS":return"success";case"FAILED":return"error";case"PENDING":return"warning";default:return"info"}}(j.fulfillmentStatus),children:[(0,t.jsx)("strong",{children:"Ошибка:"})," ",j.fulfillmentLastError]})}),void 0!==j.fulfillmentAttemptCount&&j.fulfillmentAttemptCount>=3&&(0,t.jsx)("div",{style:{marginTop:8},children:(0,t.jsxs)(d.Banner,{type:"warning",children:["Превышено максимальное количество попыток (",j.fulfillmentAttemptCount,"). Обратитесь в поддержку."]})}),("FAILED"===j.fulfillmentStatus||void 0!==j.fulfillmentAttemptCount&&j.fulfillmentAttemptCount>=3)&&(0,t.jsx)("div",{style:{marginTop:12},children:(0,t.jsx)(s.Button,{size:"m",mode:"bezeled",stretched:!0,onClick:async()=>{let e=`Заказ #${j.id}
Статус: ${j.status}
Статус выполнения: ${j.fulfillmentStatus||"N/A"}
Попыток: ${j.fulfillmentAttemptCount||0}${j.fulfillmentLastError?`
Ошибка: ${j.fulfillmentLastError}`:""}`;await (0,p.copyToClipboard)(e),(0,p.openSupport)(e)},children:"Написать в поддержку"})})]})]})]}),j.items.length>0&&(0,t.jsx)(l.Section,{header:"Товары",children:j.items.map(e=>(0,t.jsx)(r.Cell,{subtitle:(0,t.jsxs)("span",{children:[e.qty," × ",(0,t.jsx)(f.Price,{amountKopeks:e.priceKopeks,currency:j.currency})]}),children:e.title},e.id))}),g&&(0,t.jsx)(l.Section,{children:(0,t.jsx)(d.Banner,{type:"success",children:"Оплата получена. Спасибо за покупку!"})})]})]})})})}e.s(["default",()=>x])}]);